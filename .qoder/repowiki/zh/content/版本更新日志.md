# 版本更新日志

<cite>
**本文档引用的文件**  
- [package.json](file://package.json)
- [src/lib/LeafletManyPoint.ts](file://src/lib/LeafletManyPoint.ts)
- [src/lib/LeafletMapBlock.ts](file://src/lib/LeafletMapBlock.ts)
- [src/lib/ReadMe.md](file://src/lib/ReadMe.md)
</cite>

## 目录
1. [简介](#简介)
2. [版本更新历史](#版本更新历史)
3. [语义化版本控制说明](#语义化版本控制说明)
4. [升级注意事项](#升级注意事项)

## 简介
本更新日志文档记录了 `LeafletMapBlock` 库的版本演进过程，涵盖功能新增、性能优化及缺陷修复等内容。该库基于 Leaflet 和 Vue3 构建，提供高性能的 Canvas 图层支持，适用于海量点位渲染与地图区块绘制等场景。通过遵循语义化版本控制（SemVer）规范，确保用户在升级过程中能够清晰了解变更影响。

**Section sources**  
- [package.json](file://package.json#L1-L44)

## 版本更新历史

### v0.0.1（初始版本）
- **发布日期**：未明确记录（根据代码库推断为初始开发阶段）
- **新增功能**：
  - 初始发布 `ManyMarkersCanvas` 组件，支持通过 Canvas 渲染海量点位（MarkerPointOptions），具备图标与文本绘制能力。
  - 支持 SVG 图标渲染，通过 Blob 和 ObjectURL 实现动态 SVG 图像加载。
  - 实现地图事件代理机制，支持 `onIconClick`、`onIconMouseOver` 和 `onIconMouseOut` 交互事件。
- **性能优化**：
  - 引入图像缓存机制（`imageCache` 和 `svgImageCache`），避免重复加载相同图标资源。
  - 实现可视区域过滤，仅渲染当前视口内的点位，显著提升渲染效率。
  - 使用 `containerPointsCache` 缓存坐标转换结果，减少重复计算开销。
- **已修复问题**：
  - 修复地图缩放动画期间 Canvas 图层错位问题，通过 `_animateZoom` 方法实现平滑变换。
  - 修复地图移动后 Canvas 内容未同步更新的问题，通过监听 `moveend` 和 `resize` 事件触发 `_reset` 重绘。

**Section sources**  
- [src/lib/LeafletManyPoint.ts](file://src/lib/LeafletManyPoint.ts#L0-L261)
- [src/lib/ReadMe.md](file://src/lib/ReadMe.md#L0-L521)

### v0.0.1（地图区块图层）
- **新增功能**：
  - 新增 `LeafletMapBlockLayer` 类，继承自 `L.GridLayer`，用于渲染地图瓦片网格。
  - 支持自定义网格样式，包括线颜色（`strokeStyle`）、线宽（`lineWidth`）、虚线样式（`lineDash`）和网格文字显示（`showGridText`）。
  - 可在每个瓦片上显示坐标信息（x, y, z），便于调试与可视化。
- **配置项**：
  - 默认配置：红色边框、2px 线宽、[5,5] 虚线样式、显示网格文字。
  - 支持通过构造函数传入自定义选项进行覆盖。

**Section sources**  
- [src/lib/LeafletMapBlock.ts](file://src/lib/LeafletMapBlock.ts#L0-L78)
- [src/lib/ReadMe.md](file://src/lib/ReadMe.md#L0-L521)

## 语义化版本控制说明
本项目遵循 [SemVer（语义化版本控制）](https://semver.org/lang/zh-CN/) 规范，版本号格式为 `主版本号.次版本号.修订号`：
- **主版本号（Major）**：当进行不兼容的 API 修改或重大架构变更时递增。
- **次版本号（Minor）**：当以向后兼容的方式添加新功能时递增。
- **修订号（Patch）**：当进行向后兼容的问题修复时递增。

例如：
- `v1.0.0` 表示初始稳定版本。
- `v1.1.0` 表示在 `v1.0.0` 基础上新增了 SVG 图标支持等新功能。
- `v1.1.1` 表示修复了 `v1.1.0` 中的某个 bug，无新功能引入。

**Section sources**  
- [package.json](file://package.json#L2)

## 升级注意事项
- 当前版本为 `v0.0.1`，属于早期开发阶段，API 可能不稳定，不建议用于生产环境。
- 若未来引入**重大变更（breaking change）**（如重构 `MarkerPointOptions` 接口或更改事件机制），将在更新日志中明确标注，并提供详细的迁移指南。
- 建议用户在升级前查看 `src/lib/ReadMe.md` 中的使用示例与说明，确保代码兼容性。
- 对于 `ManyMarkersCanvas` 的事件处理逻辑，需注意 `onIconClick` 等回调函数的上下文绑定，避免因 `this` 指向问题导致异常。

**Section sources**  
- [src/lib/LeafletManyPoint.ts](file://src/lib/LeafletManyPoint.ts#L0-L261)
- [src/lib/ReadMe.md](file://src/lib/ReadMe.md#L0-L521)