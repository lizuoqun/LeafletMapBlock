# 快速开始

<cite>
**本文档中引用的文件**  
- [App.vue](file://src/App.vue#L1-L77)
- [LeafletManyPoint.ts](file://src/lib/LeafletManyPoint.ts#L1-L262)
- [LeafletMapBlock.ts](file://src/lib/LeafletMapBlock.ts#L1-L79)
- [README.md](file://README.md#L1-L72)
- [index.html](file://index.html#L1-L14)
</cite>

## 目录
1. [简介](#简介)
2. [项目结构概览](#项目结构概览)
3. [创建第一个地图可视化应用](#创建第一个地图可视化应用)
4. [点位数据与图层初始化](#点位数据与图层初始化)
5. [启用地图瓦片网格](#启用地图瓦片网格)
6. [事件绑定与交互](#事件绑定与交互)
7. [完整可运行代码示例](#完整可运行代码示例)
8. [学习路径闭环](#学习路径闭环)

## 简介
本教程旨在引导开发者在5分钟内完成一个基于 Leaflet 的地图可视化应用。通过使用 `ManyMarkersCanvas` 自定义图层，您将学会如何高效渲染大量带图标的点位，并通过 `LeafletMapBlockLayer` 显示地图瓦片坐标网格，帮助理解底层瓦片机制。所有示例均基于 `src/App.vue` 中的实际代码实现。

**Section sources**
- [App.vue](file://src/App.vue#L1-L77)
- [README.md](file://README.md#L1-L72)

## 项目结构概览
项目采用 Vue + TypeScript 构建，核心功能封装在 `src/lib/` 目录下：
- `LeafletManyPoint.ts`：提供高性能 Canvas 图层用于渲染大量带图标和文本的点位
- `LeafletMapBlock.ts`：实现地图瓦片网格图层，显示每个瓦片的 x, y, z 坐标
- `App.vue`：主应用入口，包含地图初始化与图层添加逻辑
- `index.html`：页面容器，挂载 Vue 应用

**Section sources**
- [App.vue](file://src/App.vue#L1-L77)
- [LeafletManyPoint.ts](file://src/lib/LeafletManyPoint.ts#L1-L262)
- [LeafletMapBlock.ts](file://src/lib/LeafletMapBlock.ts#L1-L79)

## 创建第一个地图可视化应用
### 步骤一：准备 HTML 容器
确保 `index.html` 中存在一个用于承载地图的 DOM 元素：
```html
<div id="app"></div>
```
该容器由 `main.ts` 启动时挂载 Vue 应用。

### 步骤二：引入 Leaflet 资源
在 `App.vue` 中通过模块化方式引入 Leaflet：
```ts
import L from 'leaflet';
import 'leaflet/dist/leaflet.css';
```
这会自动加载 Leaflet 的核心 JS 和 CSS 文件。

### 步骤三：初始化地图实例
在 `onMounted` 生命周期中调用 `initMap()` 函数：
```ts
const initMap = () => {
  const map = L.map('map').setView([23, 113], 5);
}
```
- `L.map('map')`：绑定 ID 为 `map` 的 DOM 容器
- `.setView([23, 113], 5)`：设置初始视图为纬度 23、经度 113，缩放级别 5

### 步骤四：添加底图瓦片
使用天地图作为底图服务：
```ts
const tdtUrl = `http://t${nodeRandom}.tianditu.gov.cn/DataServer?T=img_w&x={x}&y={y}&l={z}&tk=b11578e50812a12bd62c4dcd3d9dd082`;
const tileLayer = L.tileLayer(tdtUrl, {
  maxZoom: 18,
  minZoom: 2,
  attribution: '© modify'
});
tileLayer.addTo(map);
```
其中 `{x}`, `{y}`, `{z}` 会被 Leaflet 自动替换为当前瓦片坐标。

**Section sources**
- [App.vue](file://src/App.vue#L1-L77)
- [index.html](file://index.html#L1-L14)

## 点位数据与图层初始化
### 定义点位数组
创建包含经纬度、图标路径、自定义数据的点位数组：
```ts
const Points: MarkerPointOptions[] = [
  {
    lat: 23,
    lng: 113,
    icon: archeryImage,
    title: '自定义图标',
    iconSize: [24, 24]
  },
  {
    lat: 25,
    lng: 111,
    icon: Lulu,
    title: 'SVG',
    iconSize: [50, 50]
  }
];
```
`MarkerPointOptions` 接口定义了每个点的属性，包括点击和悬停事件回调。

### 实例化 ManyMarkersCanvas 图层
```ts
import { ManyMarkersCanvas } from './lib/LeafletManyPoint';

// @ts-ignore
const manyMark = new ManyMarkersCanvas(Points);
manyMark.addTo(map);
manyMark.addLayer();
```
- `new ManyMarkersCanvas(Points)`：创建自定义图层实例
- `addTo(map)`：将图层添加到地图
- `addLayer()`：触发图标和文本的绘制

该图层基于 Canvas 实现，支持万级点位高效渲染，并内置事件代理机制。

**Section sources**
- [App.vue](file://src/App.vue#L1-L77)
- [LeafletManyPoint.ts](file://src/lib/LeafletManyPoint.ts#L1-L262)

## 启用地图瓦片网格
为了帮助理解地图瓦片机制，可启用 `LeafletMapBlockLayer` 显示瓦片坐标：
```ts
import { LeafletMapBlockLayer } from './lib/LeafletMapBlock';

map.addLayer(new LeafletMapBlockLayer({ lineDash: [2, 2] }));
```
此图层会在每个瓦片上绘制红色虚线框，并标注其 `x:y:z` 坐标值，便于排查瓦片加载异常问题。

默认配置如下：
- 线条颜色：红色
- 线宽：2px
- 虚线样式：[5,5]
- 显示文字：是
- 文字颜色：黑色
- 字体：12px Arial

可通过构造函数参数覆盖默认设置。

**Section sources**
- [LeafletMapBlock.ts](file://src/lib/LeafletMapBlock.ts#L1-L79)
- [README.md](file://README.md#L1-L72)

## 事件绑定与交互
`ManyMarkersCanvas` 支持以下事件绑定：
```ts
onIconClick: (item) => {
  alert(item.title);
},
onIconMouseOver: (item) => {
  console.log('onIconMouseOver', item)
},
onIconMouseOut: (item) => {
  console.log('onIconMouseOut', item)
}
```
这些事件通过地图级事件监听（`click`, `mousemove`）配合坐标检测实现，避免了为每个图标单独绑定事件，提升了性能。

鼠标悬停时会自动改变光标样式为指针，提升用户体验。

**Section sources**
- [App.vue](file://src/App.vue#L1-L77)
- [LeafletManyPoint.ts](file://src/lib/LeafletManyPoint.ts#L1-L262)

## 完整可运行代码示例
以下是基于 `App.vue` 的最小化可运行代码结构：

```vue
<script setup lang="ts">
import { onMounted } from 'vue';
import L from 'leaflet';
import 'leaflet/dist/leaflet.css';
import './lib/leaflet-markers-canvas';
import { ManyMarkersCanvas, MarkerPointOptions } from './lib/LeafletManyPoint';
// @ts-ignore
import archeryImage from './assets/archery.png';

onMounted(() => {
  const map = L.map('map').setView([23, 113], 5);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

  const Points: MarkerPointOptions[] = [
    { lat: 23, lng: 113, icon: archeryImage, title: '示例点', iconSize: [24, 24] }
  ];

  const manyMark = new ManyMarkersCanvas(Points);
  manyMark.addTo(map);
  manyMark.addLayer();
});
</script>

<template>
  <div id="map" style="width: 100%; height: 100%;"></div>
</template>
```

**Section sources**
- [App.vue](file://src/App.vue#L1-L77)

## 学习路径闭环
本教程内容与 `README.md` 中的指引完全一致，形成了完整的学习闭环：
- 功能概述 → 实际编码
- 接口定义 → 类型使用
- 使用示例 → 代码实践
- 异常排查 → 瓦片网格可视化

建议在完成本快速开始后，继续阅读 `README.md` 获取更多高级配置选项和使用场景。

**Section sources**
- [README.md](file://README.md#L1-L72)
- [App.vue](file://src/App.vue#L1-L77)